{"remainingRequest":"/Users/student02/Desktop/youduitong1/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/student02/Desktop/youduitong1/src/pages/userinfo/userinfo.vue?vue&type=style&index=0&id=ea74180a&scoped=true&lang=css&","dependencies":[{"path":"/Users/student02/Desktop/youduitong1/src/pages/userinfo/userinfo.vue","mtime":1569205273000},{"path":"/Users/student02/Desktop/youduitong1/node_modules/css-loader/index.js","mtime":499162500000},{"path":"/Users/student02/Desktop/youduitong1/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/student02/Desktop/youduitong1/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/student02/Desktop/youduitong1/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/student02/Desktop/youduitong1/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.bg{\n\tposition: fixed;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 7.5rem;\n\tz-index: -1;\n}\n.van-nav-bar{\n\tbackground: rgba(0,0,0,0);\n}\n.van-nav-bar__arrow{\n\tcolor: #fff;\n\tfont-size: 1.5rem;\n}\n.van-nav-bar__title{\n\tcolor: white;\n}\n.avatar{\n\tmargin-top: 3.75rem;\n}\n.avatar img{\n\twidth:6.25rem;\n\theight:6.25rem;\n\tborder-radius:50%;\n\tborder: 0.0625rem solid #F2F3F5;\n}\n.info{\n\tmargin: 0.625rem 0.625rem 0 0.625rem;\n\tborder-radius: 0.5rem;\n\toverflow: hidden;\n}\n.info .van-cell{\n\ttext-align: left;\n}\n.van-overlay{\n\tbackground: rgba(0,0,0,0);\n}\n",{"version":3,"sources":["userinfo.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAyVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"userinfo.vue","sourceRoot":"src/pages/userinfo","sourcesContent":["<template>\n\t<div id=\"userinfo\">\n\t\t<img :src=\"bg\" class=\"bg\">\n\t\t<van-nav-bar\n\t\t\ttitle=\"个人资料\"\n\t\t\tleft-arrow\n\t\t\tfixed\n\t\t\t@click-left=\"goBack\"\n\t\t\t:border=\"border\"\n\t\t/>\n\t\t\n\t\t<van-row class=\"avatar\">\n\t\t\t<van-col span=\"24\">\n\t\t\t\t<img :src=\"avatar\" @click=\"showActionSheet\">\n\t\t\t\t<!-- <van-image \n\t\t\t\t\t:src=\"avatar\"\n\t\t\t\t\tround\n\t\t\t\t\twidth=\"6.25rem\"\n\t\t\t\t\theight=\"6.25rem\"\n\t\t\t\t\t@click=\"showActionSheet\"\n\t\t\t\t/> -->\n\t\t\t</van-col>\n\t\t</van-row>\n\t\t\n\t\t<van-cell-group class=\"info\">\n\t\t\t<van-cell v-for=\"(item,index) in getDataList\" :key=\"index\"\n\t\t\t\t:icon=\"item.image\"\n\t\t\t\t:title=\"item.title\"\n\t\t\t\t:value=\"item.content\"\n\t\t\t\tis-link\n\t\t\t\t@click='to(item.name)'\n\t\t\t>\n\t\t\t</van-cell>\n\t\t</van-cell-group>\n\t\t\n\t\t<van-datetime-picker \n\t\t\tv-if=\"dateBar\"\n\t\t\tv-model=\"birthday\"\n\t\t\ttype=\"date\"\n\t\t\t:min-date=\"minDate\"\n\t\t\t:max-date=\"maxDate\"\n\t\t\t:formatter=\"formatter\"\n\t\t\t@confirm=\"modifyBirthday\"\n\t\t\t@cancel=\"cancel\"\n\t\t/>\n\t\t\n\t\t<van-action-sheet\n\t\t\tv-model=\"actionShow\"\n\t\t\t:actions=\"actions\"\n\t\t\tcancel-text=\"取消\"\n\t\t\t:close-on-click-action=\"closeonclickaction\"\n\t\t\t:safe-area-inset-bottom=\"safeareainsetbottom\"\n\t\t\t@select=\"onSelect\"\n\t\t\t@cancel=\"onCancel\"\n\t\t/>\n\t\t\n\t\t<van-overlay :show=\"show\" class-name=\"overlay\" />\n\t\t<van-loading v-if=\"show\" vertical>{{loadingText}}</van-loading>\n\n\t</div>\n</template>\n\n<script>\n\timport {Images} from '@/resources/index.js'\n\timport {NavBar,Row,Col,CellGroup,Cell,DatetimePicker,Overlay,Loading,ActionSheet,Toast} from 'vant'\n\texport default{\n\t\tcomponents:{\n\t\t\t[NavBar.name]:NavBar,\n\t\t\t[Row.name]:Row,\n\t\t\t[Col.name]:Col,\n\t\t\t[CellGroup.name]:CellGroup,\n\t\t\t[Cell.name]:Cell,\n\t\t\t[DatetimePicker.name]:DatetimePicker,\n\t\t\t[Overlay.name]:Overlay,\n\t\t\t[Loading.name]:Loading,\n\t\t\t[ActionSheet.name]:ActionSheet,\n\t\t\t[Toast.name]:Toast,\n\t\t},\n\t\tdata(){\n\t\t\treturn{\n\t\t\t\tbg:Images.mineView.ic_bg,\n\t\t\t\tborder:false,\n\t\t\t\tavatar:'',\n\t\t\t\tbirthday:'',\n\t\t\t\tminDate:new Date(1970,0,1),\n\t\t\t\tmaxDate:new Date(),\n\t\t\t\tdateBar:false,\n\t\t\t\tshow:false,\n\t\t\t\tloadingText:'修改中...',\n\t\t\t\tactionShow:false,\n\t\t\t\tcloseonclickaction:true,\n\t\t\t\tsafeareainsetbottom:true,\n\t\t\t\tactions:[\n\t\t\t\t\t{name:'从相册选取'},\n\t\t\t\t\t{name:'拍照'}\n\t\t\t\t],\n\t\t\t}\n\t\t},\n\t\tmethods:{\n\t\t\tgoBack(){\n\t\t\t\tthis.$store.commit('changeTabbarActive','mine')\n\t\t\t\tthis.$router.push('/main/mine')\n\t\t\t},\n\t\t\tto(name){\n\t\t\t\tif (name === 'modifyNickname') {\n\t\t\t\t\tthis.$router.push('/modifyNickname')\n\t\t\t\t} else if (name === 'modifyGender') {\n\t\t\t\t\tthis.$router.push('/modifyGender')\n\t\t\t\t} else if (name === 'modifyEmail') {\n\t\t\t\t\tthis.$router.push('/modifyEmail')\n\t\t\t\t} else if (name === 'modifyBirthday') {\n\t\t\t\t\tthis.dateBar = true\n\t\t\t\t} else{\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t},\n\t\t\tmodifyBirthday(value){\n\t\t\t\tvar year = value.getFullYear()\n\t\t\t\tvar month = value.getMonth()+1\n\t\t\t\tvar day = value.getDate()\n\t\t\t\tvar birthday = year+'年'+month+'月'+day+'日'\n\t\t\t\tthis.dateBar = false\n\t\t\t\tthis.show = true\n\t\t\t\tthis.loadingText = '修改中...'\n\t\t\t\tvar url = '/user/birth?user_id='+this.$store.state.userID+'&birth='+birthday+'&token='+this.$store.state.token\n\t\t\t\tthis.axios.get(url).then((response)=>{\n\t\t\t\t\tif (response.data.detail && response.data.detail == 'token异常，重新登陆') {\n\t\t\t\t\t\tToast('登陆过期，请重新登录')\n\t\t\t\t\t\tthis.$router.push('/login')\n\t\t\t\t\t}else if (response.data.status == 1) {\n\t\t\t\t\t\tsetTimeout(()=>{\n\t\t\t\t\t\t\tthis.loadingText = response.data.detail\n\t\t\t\t\t\t\tthis.$store.commit('birthday',birthday)\n\t\t\t\t\t\t\tsetTimeout(()=>{\n\t\t\t\t\t\t\t\tthis.show = false\n\t\t\t\t\t\t\t},500)\n\t\t\t\t\t\t},1000)\n\t\t\t\t\t} else{\n\t\t\t\t\t\tsetTimeout(()=>{\n\t\t\t\t\t\t\tToast(response.data.detail)\n\t\t\t\t\t\t\tthis.show = false\n\t\t\t\t\t\t},1000)\n\t\t\t\t\t}\n\t\t\t\t}).catch((response)=>{\n\t\t\t\t\tsetTimeout(()=>{\n\t\t\t\t\t\tToast('网络请求出错，请稍候再试!')\n\t\t\t\t\t\tthis.show = false\n\t\t\t\t\t},1000)\n\t\t\t\t})\n\t\t\t},\n\t\t\tformatter(type,value){\n\t\t\t\tif(type === 'year'){\n\t\t\t\t\treturn `${value}年`\n\t\t\t\t}else if(type === 'month'){\n\t\t\t\t\treturn `${value}月`\n\t\t\t\t}else if(type === 'day'){\n\t\t\t\t\treturn `${value}日`\n\t\t\t\t}\n\t\t\t\treturn value\n\t\t\t},\n\t\t\tcancel(){\n\t\t\t\tthis.dateBar = false\n\t\t\t},\n\t\t\tshowActionSheet(){\n\t\t\t\tthis.actionShow = true\n\t\t\t},\n\t\t\tonSelect(item){\n\t\t\t\tif (item.name === '从相册选取') {\n\t\t\t\t\tthis.actionShow = false\n\t\t\t\t\tthis.galleryImgs()\n\t\t\t\t}\n\t\t\t\tif (item.name === '拍照') {\n\t\t\t\t\tthis.actionShow = false\n\t\t\t\t\tthis.getImage()\n\t\t\t\t}\n\t\t\t},\n\t\t\tonCancel(){\n\t\t\t\t\n\t\t\t},\n\t\t\tgalleryImgs(){\n\t\t\t\tplus.gallery.pick((path)=>{\n\t\t\t\t\tthis.imgPreviewnew(path)\n\t\t\t\t},(e)=>{\n\t\t\t\t\tToast(e.message)\n\t\t\t\t},{\n\t\t\t\t\tfilter:\"image\"\n\t\t\t\t})\n\t\t\t},\n\t\t\tgetImage(){\n\t\t\t\tvar cmr = plus.camera.getCamera()\n\t\t\t\tcmr.captureImage((p)=>{\n\t\t\t\t\tplus.io.resolveLocalFileSystemURL(p,(entry)=>{\n\t\t\t\t\t\tvar imgUrl = entry.toLocalURL()\n\t\t\t\t\t\tthis.imgPreviewnew(imgUrl)\n\t\t\t\t\t})\n\t\t\t\t},(e)=>{\n\t\t\t\t\t\tToast(e.message)\n\t\t\t\t},{\n\t\t\t\t\tindex:1,\n\t\t\t\t\tfilename:'_doc/camera/'\n\t\t\t\t})\n\t\t\t},\n\t\t\tuploadImage(file){\n\t\t\t\tvar url = '/user/upload?token=' + this.$store.state.token\n\t\t\t\tvar formData = new FormData()\n\t\t\t\tformData.append('file',file)\n\t\t\t\tformData.append('user_id',this.$store.state.userID)\n\t\t\t\tthis.axios.post(url,formData).then((response)=>{\n\t\t\t\t\tif (response.data.detail && response.data.detail == 'token异常，重新登陆') {\n\t\t\t\t\t\tToast('登陆过期，请重新登录')\n\t\t\t\t\t\tthis.$router.push('/login')\n\t\t\t\t\t}else if(response.data.status === 1){\n\t\t\t\t\t\tthis.avatar = response.data.obj+'?v='+Math.random()\n\t\t\t\t\t\tthis.$store.commit('avatar',response.data.obj+'?v='+Math.random())\n\t\t\t\t\t\tToast('头像上传成功')\n\t\t\t\t\t} else{\n\t\t\t\t\t\tToast('头像上传失败,请重试')\n\t\t\t\t\t}\n\t\t\t\t}).catch((response)=>{\n\t\t\t\t\tToast('网络请求出错，请重试')\n\t\t\t\t})\n\t\t\t},\n\t\t\timgPreviewnew(file){\n\t\t\t\tlet that = this\n\t\t\t\tlet Orientation\n\t\t\t\tlet img = new Image()\n\t\t\t\timg.src = file\n\t\t\t\timg.onload = function(){\n\t\t\t\t\tlet base64 = that.compress(img,Orientation)\n\t\t\t\t\t// console.log(data)\n\t\t\t\t\tlet blob = that.dataURLtoBlob(base64)\n\t\t\t\t\tvar file = that.blobToFile(blob,\"image.png\")\n\t\t\t\t\tthat.uploadImage(file)\n\t\t\t\t}\n\t\t\t},\n\t\t\tcompress(img,Orientation) {\n\t\t\t\tlet canvas = document.createElement(\"canvas\");\n\t\t\t\tlet ctx = canvas.getContext('2d');\n\t\t\t\t//瓦片canvas\n\t\t\t\tlet tCanvas = document.createElement(\"canvas\");\n\t\t\t\tlet tctx = tCanvas.getContext(\"2d\");\n\t\t\t\tlet initSize = img.src.length;\n\t\t\t\tlet width = img.width;\n\t\t\t\tlet height = img.height;\n\t\t\t\t//如果图片大于四百万像素，计算压缩比并将大小压至400万以下\n\t\t\t\tlet ratio;\n\t\t\t\tif ((ratio = width * height / 4000000) > 1) {\n\t\t\t\t\tconsole.log(\"大于400万像素\")\n\t\t\t\t\tratio = Math.sqrt(ratio);\n\t\t\t\t\twidth /= ratio;\n\t\t\t\t\theight /= ratio;\n\t\t\t\t} else {\n\t\t\t\t\tratio = 1;\n\t\t\t\t}\n\t\t\t\tcanvas.width = width;\n\t\t\t\tcanvas.height = height;\n\t\t\t\t//        铺底色\n\t\t\t\tctx.fillStyle = \"#fff\";\n\t\t\t\tctx.fillRect(0, 0, canvas.width, canvas.height);\n\t\t\t\t//如果图片像素大于100万则使用瓦片绘制\n\t\t\t\tlet count;\n\t\t\t\tif ((count = width * height / 1000000) > 1) {\n\t\t\t\t\tconsole.log(\"超过100W像素\");\n\t\t\t\t\tcount = ~~(Math.sqrt(count) + 1); //计算要分成多少块瓦片\n\t\t\t\t\t//            计算每块瓦片的宽和高\n\t\t\t\t\tlet nw = ~~(width / count);\n\t\t\t\t\tlet nh = ~~(height / count);\n\t\t\t\t\ttCanvas.width = nw;\n\t\t\t\t\ttCanvas.height = nh;\n\t\t\t\t\tfor (let i = 0; i < count; i++) {\n\t\t\t\t\t\tfor (let j = 0; j < count; j++) {\n\t\t\t\t\t\t\ttctx.drawImage(img, i * nw * ratio, j * nh * ratio, nw * ratio, nh * ratio, 0, 0, nw, nh);\n\t\t\t\t\t\t\tctx.drawImage(tCanvas, i * nw, j * nh, nw, nh);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tctx.drawImage(img, 0, 0, width, height);\n\t\t\t\t}\n\t\t\t\t//修复ios上传图片的时候 被旋转的问题\n\t\t\t\tif(Orientation != \"\" && Orientation != 1){\n\t\t\t\t\tswitch(Orientation){\n\t\t\t\t\t\tcase 6://需要顺时针（向左）90度旋转\n\t\t\t\t\t\t\tthis.rotateImg(img,'left',canvas);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 8://需要逆时针（向右）90度旋转\n\t\t\t\t\t\t\tthis.rotateImg(img,'right',canvas);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 3://需要180度旋转\n\t\t\t\t\t\t\tthis.rotateImg(img,'right',canvas);//转两次\n\t\t\t\t\t\t\tthis.rotateImg(img,'right',canvas);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t//进行最小压缩\n\t\t\t\tlet ndata = canvas.toDataURL('image/jpeg', 0.1);\n\t\t\t\tconsole.log('压缩前：' + initSize);\n\t\t\t\tconsole.log('压缩后：' + ndata.length);\n\t\t\t\tconsole.log('压缩率：' + ~~(100 * (initSize - ndata.length) / initSize) + \"%\");\n\t\t\t\ttCanvas.width = tCanvas.height = canvas.width = canvas.height = 0;\n\t\t\t\treturn ndata;\n\t\t\t},\n\t\t\tdataURLtoBlob(dataurl){\n\t\t\t\tvar arr = dataurl.split(',')\n\t\t\t\tvar mime = arr[0].match(/:(.*?);/)[1]\n\t\t\t\tvar bstr = atob(arr[1])\n\t\t\t\tvar n = bstr.length\n\t\t\t\tvar u8arr = new Uint8Array(n)\n\t\t\t\twhile (n--){\n\t\t\t\t\tu8arr[n] = bstr.charCodeAt(n)\n\t\t\t\t}\n\t\t\t\treturn new Blob([u8arr],{type:mime})\n\t\t\t},\n\t\t\tblobToFile(blob,fileName){\n\t\t\t\tblob.lastModifiedDate = new Date()\n\t\t\t\tblob.name = fileName\n\t\t\t\treturn blob\n\t\t\t}\n\t\t},\n\t\tmounted() {\n\t\t\tthis.avatar = this.$store.state.avatar ? this.$store.state.avatar : Images.mineView.ic_default_head2\n\t\t\tvar str = this.$store.state.birthday\n\t\t\tlet len1 = str.indexOf('年')\n\t\t\tlet len2 = str.indexOf('月')\n\t\t\tlet s1 = str.substring(0,len1)\n\t\t\tlet s2 = str.substring(len1+1,len2)\n\t\t\tlet s3 = str.substring(len2+1,str.length-1)\n\t\t\tthis.birthday = new Date(s1,s2-1,s3)\n\t\t},\n\t\tcomputed:{\n\t\t\tgetDataList(){\n\t\t\t\treturn (\n\t\t\t\t\t[\n\t\t\t\t\t\t{image:Images.mineView.ic_info_data[0],title:'昵称',content:this.$store.state.nickname,name:'modifyNickname'},\n\t\t\t\t\t\t{image:Images.mineView.ic_info_data[1],title:'性别',content:this.$store.state.gender,name:'modifyGender'},\n\t\t\t\t\t\t{image:Images.mineView.ic_info_data[2],title:'出生年月',content:this.$store.state.birthday,name:'modifyBirthday'},\n\t\t\t\t\t\t{image:Images.mineView.ic_info_data[3],title:'邮箱',content:this.$store.state.email,name:'modifyEmail'},\n\t\t\t\t\t\t{image:Images.mineView.ic_info_data[4],title:'实名认证',content:'身份证',name:'Autonym'}\n\t\t\t\t\t]\n\t\t\t\t)\n\t\t\t},\n\t\t}\n\t}\n</script>\n\n<style scoped>\n\t.bg{\n\t\tposition: fixed;\n\t\ttop: 0;\n\t\tleft: 0;\n\t\twidth: 100%;\n\t\theight: 7.5rem;\n\t\tz-index: -1;\n\t}\n\t.van-nav-bar{\n\t\tbackground: rgba(0,0,0,0);\n\t}\n\t.van-nav-bar__arrow{\n\t\tcolor: #fff;\n\t\tfont-size: 1.5rem;\n\t}\n\t.van-nav-bar__title{\n\t\tcolor: white;\n\t}\n\t.avatar{\n\t\tmargin-top: 3.75rem;\n\t}\n\t.avatar img{\n\t\twidth:6.25rem;\n\t\theight:6.25rem;\n\t\tborder-radius:50%;\n\t\tborder: 0.0625rem solid #F2F3F5;\n\t}\n\t.info{\n\t\tmargin: 0.625rem 0.625rem 0 0.625rem;\n\t\tborder-radius: 0.5rem;\n\t\toverflow: hidden;\n\t}\n\t.info .van-cell{\n\t\ttext-align: left;\n\t}\n\t.van-overlay{\n\t\tbackground: rgba(0,0,0,0);\n\t}\n</style>\n"]}]}